{% extends "base.html" %}
{% block title %}Products{% endblock %}
{% block content %}

<input id="number_of_products" value="{{products|length}}" readonly hidden>
<input id="number_of_categories" value="{{categories|length}}" readonly hidden>

<!-- Hero Section -->
<section class="py-7 text-center bg-light" style="padding-top: 6rem; padding-bottom: 6rem;">
  <div class="container">
    <h1 class="display-5 fw-bold">The new Pixel 6 phones are here.</h1>
    <p class="lead mb-4">Powered by Google Tensor, Googleâ€™s first custom-built processor, they're fast and secure. And they adapt to you.</p>
    <a href="#" class="btn btn-outline-dark btn-lg">Learn more</a>
  </div>
</section>

<!-- Main Content -->
<section class="py-5">
  <div class="container">
    <div class="row">

      <!-- Sidebar Filters -->
      <div class="col-lg-3 mb-5">
        <div class="position-sticky" style="top: 100px;">
          <h5 class="mb-3">CATEGORIES</h5>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <small class="text-muted">Select Category</small>
            <a href="#" id="resetFilters" class="text-muted small text-decoration-none">Reset All</a>
          </div>

          <form id="filterForm">
            <div id="categoryList">
              {% for category in categories[:6] %}
              <div class="form-check">
                <input class="form-check-input category-check" type="checkbox" value="{{category.id }}" id="cat_{{category.id}}">
                <label class="form-check-label" for="cat_{{ category.id }}">
                  {{ category.category }} <small class="text-muted" id="cat_{{category.id}}_text">placeholder</small>
                </label>
              </div>
              {% endfor %}
              {% if categories|length > 6 %}
              <div class="collapse" id="moreCategories">
                {% for category in categories[6:] %}
                <div class="form-check">
                  <input class="form-check-input category-check" type="checkbox" value="{{ category.id }}" id="cat_{{category.id}}">
                  <label class="form-check-label" for="cat_{{category.id }}">
                    {{ category.category }} <small class="text-muted" id="cat_{{category.id}}_text">(placeholder)</small> <!--category.count needs to be passed in from a query-->
                  </label>
                </div>
                {% endfor %}
              </div>
              <a class="text-primary small d-block mt-2" data-bs-toggle="collapse" href="#moreCategories" role="button" aria-expanded="false" aria-controls="moreCategories">
                [+] {{ categories|length - 6 }} more
              </a>
              {% endif %}
            </div>
          </form>
          <div class="py-5">
            <form class="sort_form">
              <h5 class="mb-3">SORT</h5>
              <div class="d-flex justify-content-between align-items-center mb-2">
                
                  <small class="text-muted">Sort By</small>
                  <a href="/" id="default_sort" class="text-muted small text-decoration-none">Default</a>
              </div>
              <div class="form-check">
                <a href="/sort_products_a-z" id="a-z" class="text-muted small text-decoration-none">a-z</a>
              </div>
              <div class="form-check">
                <a href="/sort_products_z-a" id="z-a" class="text-muted small text-decoration-none">z-a</a>
              </div>
              <div class="form-check">
                <a href="/sort_products_low-high" id="low-high" class="text-muted small text-decoration-none">price: low-high</a>
              </div>
              <div class="form-check">
                <a href="/sort_products_high-low" id="high-low" class="text-muted small text-decoration-none">price: high-low</a>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Product Grid -->
      <div class="col-lg-9">
        <div class="row" id="productGrid">
          {% for product in products %}
          <div class="col-md-6 col-lg-4 mb-4 product-item" data-category="{{ product.category }}">
            <div class="card h-100 shadow-sm hover-card" style="background-color: #f8f9fa;">
              <div class="ratio ratio-1x1 p-4">
                
                <div class="ratio ratio-1x1 p-4 d-flex justify-content-center align-items-center">
                  <a href="/product_view_{{ product.id }}">
                    <img src="{{ product.image }}" class="img-fluid mx-auto d-block hover-image" style="max-height: 200px; object-fit: contain;" alt="{{ product.name }}">
                  </a>
                </div>
              </div>
              <div class="card-body text-center">
                <h5 class="card-title">{{ product.name }}</h5>
                <p class="text-muted">From ${{ product.price }} {{ product.unit }}</p>
                <button id="add_to_cart_{{ product.id }}" class="btn text-light w-100" style="background-color: #609174;">Add to cart</button>
                <div id="cart_options_{{ product.id }}" class="mt-3" hidden>
                  <input type="hidden" name="product_id" value="{{ product.id }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <div class="d-flex justify-content-center align-items-center gap-2">
                    <button id="minus_button_{{ product.id }}" class="btn btn-outline-secondary btn-sm">-</button>
                    <input type="number" min="0" id="cart_product_quantity_{{ product.id }}" class="form-control form-control-sm text-center" style="width: 70px;">
                    <button id="plus_button_{{ product.id }}" class="btn btn-outline-secondary btn-sm">+</button>
                    <button id="confirm_cart_{{ product.id }}" class="btn btn-success btn-sm">Confirm</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Bootstrap + Icons -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<script type="text/javascript" src="static/products.js"></script>

<!-- Hover and Filter Style -->
<style>
  .hover-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .hover-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }
  .hover-image {
    transition: transform 0.3s ease;
  }
  .hover-card:hover .hover-image {
    transform: scale(1.05);
  }
</style>
{% endblock %}