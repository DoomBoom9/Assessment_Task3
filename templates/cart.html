{% extends "base.html" %}
{% block title %}Shopping Cart{% endblock %}
{% block pageName %}<div id="pageName">Shopping Cart</div>{% endblock %}
{% block content %}

<style>
    .cart-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 2rem auto;
        gap: 1.5rem;
        max-width: 1000px;
    }

    .cart-item {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: 1.5rem;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        background-color: white;
        gap: 1.5rem;
    }

    .cart-image {
        width: 150px;
        height: 150px;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        overflow: hidden;
        background-color: #f9f9f9;
    }

    .cart-image img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    .cart-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .cart-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
    }

    .cart-actions {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 1rem;
        margin-top: 2rem;
    }

    .btn-green {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-green:hover {
        background-color: #45a049;
    }

    .btn-clear {
        background-color: #e53935;
        color: white;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-clear:hover {
        background-color: #d32f2f;
    }
</style>
<div class="container mt-4"  style="padding-top: 5rem;">
    <div class="row">
      
      <!-- Cart Items Column -->
      <div class="col-lg-8">
        {% for item in cart %}
        <input class="product_ids" value="{{item.id}}" readonly hidden>
        <div class="cart-item mb-3 p-2 border rounded shadow-sm bg-white d-flex">
          <div class="me-3 d-flex align-items-center" style="width: 120px; height: 120px;">
            <a href="/product_view_{{ item.id }}" class="w-100 h-100 d-flex align-items-center justify-content-center">
              <img src="{{ item.image }}" class="img-fluid" style="max-height: 100%; max-width: 100%; object-fit: contain;" alt="{{ item.name }}">
            </a>
          </div>
          <div class="cart-info flex-grow-1">
            <strong class="d-block mb-1">{{ item.name }}</strong>
            <div class="d-flex flex-wrap gap-3 small text-muted">
              <div>Price: ${{ item.price }}</div>
              <div>Unit: {{ item.unit }}</div>
              <div>Qty: {{ cart[item] }}</div>
              <input id="qty_{{item.id}}" value="{{cart[item]}}" readonly hidden>
              <div>Subtotal: ${{ cart[item]*item.price }}</div>
            </div>
          </div>
          <div class="d-flex align-items-start">
            <button class="btn btn-sm btn-outline-secondary ms-3" id="remove_{{item.id}}">Remove</button>
          </div>
          <div id="cart_options_{{item.id }}" class="mt-3" hidden>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="d-flex justify-content-center align-items-center gap-2">
              <button id="minus_button_{{ item.id }}" class="btn btn-outline-secondary btn-sm">-</button>
              <input type="number" min="0" id="cart_product_quantity_{{ item.id }}" class="form-control form-control-sm text-center" style="width: 70px;">
              <button id="plus_button_{{ item.id }}" class="btn btn-outline-secondary btn-sm">+</button>
              <button id="confirm_{{ item.id }}" class="btn btn-success btn-sm">Confirm</button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
  
      <!-- Sticky Cart Summary Column -->
      <div class="col-lg-4 position-sticky" style="top: 100px; height: fit-content;">
        <div class="border rounded p-4 bg-white shadow-sm">
          {% set totals = [] %}
          {% for item in cart %}
              {% if totals.append(cart[item]*item.price) %}{% endif %}
          {% endfor %}
          {% set total = totals | sum %}
  
          <h4 class="mb-3">Total: ${{ total }}</h4>
  
          <form action="/cart" method="POST" class="mb-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input name="honeypot" class="visually-hidden" tabindex="-1" autocomplete="off">
            <button type="submit" class="btn btn-success w-100">Checkout</button>
          </form>
  
          <form action="/clear_cart" method="GET">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input name="honeypot" class="visually-hidden" tabindex="-1" autocomplete="off">
            <button type="submit" class="btn btn-danger w-100">Clear Cart</button>
          </form>
        </div>
      </div>
    </div>
</div>
<script src="static/cart.js"></script>
{%endblock%}